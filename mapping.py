import math
import matplotlib.pyplot as plt

def make_map(motor_data, map_filename="map.png"):
    '''
    Takes in array of left and right wheel distances traveled per time step
    [[0,1],[2,3],...]
    plots path taken by rover
    saves figure under timestamp 
    gui opens and displays image
    returns nothing
    '''
    wheel_separation = 0.251075
    #seperate left and right wheel data
    left_wheel = [LR[0] for LR in motor_data]
    right_wheel = [LR[1] for LR in motor_data]

    #initialize x,y, and pose
    #theta here is inital heading angle in radians
    #0 = east, pi/2 = north, etc.
    x,y,theta = 0,0,0#math.pi/2 
    positions = [(x,y)]

    #pose is relative to previous pose, so update pose
    #make arrays using second order midpoint method

    for i in range(0, len(left_wheel)):
        #get distance traveled by center
        d_center = (left_wheel[i] + right_wheel[i]) / 2.0
        #get change in pose
        d_theta = (right_wheel[i] - left_wheel[i]) / wheel_separation
        
        #create new posistion point
        x += d_center * math.cos(theta + d_theta / 2)
        y += d_center * math.sin(theta + d_theta / 2)
        theta += d_theta

        positions.append((x, y))

    # Plot path
    xs, ys = zip(*positions)
    plt.plot(xs, ys, marker='o',markersize=4)
    plt.axis('equal')
    plt.title("Path drawn from motor data")
    plt.xlabel("X position (m)")
    plt.ylabel("Y position (m)")
    #plt.show() #only for testing, plt.save intented 
    plt.savefig(map_filename, dpi=150, bbox_inches="tight")
    return 0

#testing section
if __name__ == "__main__":
    import random
    #random motor data
    motor_data = []
    for _ in range(1365):
        left = random.uniform(0.0, 0.2)
        right = random.uniform(0.0, 0.2)
        motor_data.append((left, right))

    import numpy as np

    def generate_figure8(wheel_separation=0.251, dt=0.01, v=0.20, radius=1.0):
        # angular velocity for chosen radius
        omega = v / radius

        # time required for one full 2Ï€ loop
        T = 2*np.pi / abs(omega)
        steps = int(T/dt)

        motor_data = []

        # First loop: turn LEFT
        for _ in range(steps):
            v_l = v - (omega * wheel_separation / 2)
            v_r = v + (omega * wheel_separation / 2)
            motor_data.append([v_l*dt, v_r*dt])

        # Second loop: turn RIGHT (reverse omega)
        for _ in range(steps):
            v_l = v + (omega * wheel_separation / 2)
            v_r = v - (omega * wheel_separation / 2)
            motor_data.append([v_l*dt, v_r*dt])

        return motor_data

    motor_data = generate_figure8()


#[[0.035431,0.03513],[0.035465,0.034857],[0.035433,0.034587],[0.03518,0.034345],[0.034707,0.034149],[0.034038,0.034005],[0.033218,0.033918],[0.032316,0.03389],[0.03142,0.033922],[0.030631,0.033999],[0.030058,0.034106],[0.029791,0.03422],[0.029889,0.034312],[0.030382,0.034355],[0.031263,0.034317],[0.032485,0.034165],[0.0340,0.03386],[0.03525,0.03337],[0.03613,0.03267],[0.03658,0.03174],[0.03657,0.03054],[0.03611,0.02909],[0.03524,0.02741],[0.03402,0.02551],[0.03252,0.02346],[0.03083,0.02132],[0.02901,0.01917],[0.02708,0.01706],[0.02504,0.01505],[0.02292,0.0132],[0.02072,0.01154],[0.01847,0.01008],[0.01621,0.00881],[0.01401,0.0077],[0.0119,0.00678],[0.00994,0.00602],[0.00821,0.00547],[0.00673,0.00509],[0.00556,0.0049],[0.00478,0.00486],[0.00446,0.00495],[0.00465,0.00511],[0.00539,0.00534],[0.00672,0.00559],[0.00873,0.00586],[0.01141,0.00612],[0.0148,0.00636],[0.01883,0.00655],[0.02343,0.00669],[0.02849,0.00676],[0.03388,0.00676],[0.03953,0.00666],[0.04527,0.00647],[0.05099,0.00617],[0.05658,0.00576],[0.06194,0.00524],[0.06699,0.00452],[0.07167,0.00361],[0.07597,0.00253],[0.07988,0.00127],[0.08342,0.00001],[0.08661,-0.00123],[0.08949,-0.00248],[0.09207,-0.00374],[0.09439,-0.00502],[0.09648,-0.00631],[0.09837,-0.00761],[0.10009,-0.00893],[0.10168,-0.01027],[0.10318,-0.01163],[0.10462,-0.0130],[0.10604,-0.01438],[0.10747,-0.01577],[0.10893,-0.01718],[0.11046,-0.01861],[0.11209,-0.02006],[0.11385,-0.02153],[0.1158,-0.02302],[0.11798,-0.02454],[0.12042,-0.02608],[0.12313,-0.02764],[0.12614,-0.02923],[0.12947,-0.03085],[0.13312,-0.03248],[0.1371,-0.03415],[0.14141,-0.03583],[0.14604,-0.03755],[0.15098,-0.03929],[0.15619,-0.04106],[0.16162,-0.04286],[0.16719,-0.04469],[0.17282,-0.04654],[0.17841,-0.04841],[0.18386,-0.05029],[0.18906,-0.05218],[0.19392,-0.05406],[0.19836,-0.05593],[0.20229,-0.05777],[0.20563,-0.05958],[0.20831,-0.06134],[0.21028,-0.06305],[0.21149,-0.0647],[0.21191,-0.06629],[0.2115,-0.0678],[0.21025,-0.06922],[0.20817,-0.07054],[0.20527,-0.07175],[0.2016,-0.07285],[0.19721,-0.07382],[0.19218,-0.07468],[0.1866,-0.07541],[0.18061,-0.07602],[0.17433,-0.07651],[0.16794,-0.0769],[0.16156,-0.0772],[0.15538,-0.07743],[0.14958,-0.07759],[0.14434,-0.0777],[0.13982,-0.07777],[0.13614,-0.07781],[0.13343,-0.07783],[0.13178,-0.07783],[0.13128,-0.07782],[0.13198,-0.0778],[0.13397,-0.07776],[0.13733,-0.07772],[0.14208,-0.07767],[0.14822,-0.07762],[0.15569,-0.07756],[0.16442,-0.0775],[0.1743,-0.07745],[0.18521,-0.0774],[0.19701,-0.07736],[0.20953,-0.07734],[0.22258,-0.07733],[0.23595,-0.07734],[0.24942,-0.07738],[0.26275,-0.07745],[0.27572,-0.07756],[0.28809,-0.07773],[0.29966,-0.07796],[0.31019,-0.07826],[0.31946,-0.07863],[0.32725,-0.07908],[0.33336,-0.07962],[0.33757,-0.08025],[0.3397,-0.08098],[0.33956,-0.08182],[0.33707,-0.08278],[0.33218,-0.08385],[0.32487,-0.08505],[0.31519,-0.08638],[0.30327,-0.08785],[0.28926,-0.08946],[0.27336,-0.09122],[0.25588,-0.09313],[0.23714,-0.09519],[0.21754,-0.09742],[0.19751,-0.09982],[0.17749,-0.1024],[0.15795,-0.10518],[0.13936,-0.10815],[0.12221,-0.11131],[0.10699,-0.11467],[0.09405,-0.11823],[0.08376,-0.12199],[0.07645,-0.12594],[0.07238,-0.13007],[0.07176,-0.13438],[0.07476,-0.13886],[0.08145,-0.1435],[0.09189,-0.14829],[0.10606,-0.15322],[0.1239,-0.15828],[0.14528,-0.16345],[0.17001,-0.16873],[0.19789,-0.17409],[0.22868,-0.17952],[0.26212,-0.18499],[0.29794,-0.19047],[0.33587,-0.19593],[0.37563,-0.20134],[0.41695,-0.20668],[0.45957,-0.21193],[0.50324,-0.21705],[0.5477,-0.22203],[0.59272,-0.22684],[0.63806,-0.23146],[0.6835,-0.23587],[0.72879,-0.24005],[0.7737,-0.24397],[0.81802,-0.24761],[0.86149,-0.25094],[0.90386,-0.25395],[0.94488,-0.25662],[0.98433,-0.25893],[1.022, -0.26087],[1.0576,-0.26243],[1.0909,-0.2636],[1.1217,-0.26438],[1.1499,-0.26478],[1.1752,-0.26479],[1.1975,-0.26441],[1.2167,-0.26366],[1.2328,-0.26255],[1.2458,-0.26109],[1.2557,-0.2593],[1.2626,-0.25718],[1.2667,-0.25476],[1.2682,-0.25204],[1.2673,-0.24904],[1.2641,-0.24579],[1.2589,-0.24233],[1.2518,-0.2387],[1.2431,-0.23495],[1.2329,-0.23112],[1.2215,-0.22726],[1.209,-0.22341],[1.1957,-0.21962],[1.1819,-0.21595],[1.1678,-0.21243],[1.1536,-0.20912],[1.1395,-0.20606],[1.1257,-0.2033],[1.1122,-0.2009],[1.0992,-0.1989],[1.0868,-0.19737],[1.075,-0.19637],[1.0639,-0.19594],[1.0536,-0.19611],[1.044,-0.19695],[1.0351,-0.19847],[1.0269,-0.20071],[1.0194,-0.2037],[1.0126,-0.20745],[1.0066,-0.21199],[1.0012,-0.21736],[0.9963,-0.22356],[0.9917,-0.23062],[0.9873,-0.23856],[0.9829,-0.24739],[0.9784,-0.25714],[0.9736,-0.26783],[0.9683,-0.27947],[0.9623,-0.29206],[0.9554,-0.3056],[0.9473,-0.32009],[0.9378,-0.33552],[0.9266,-0.35188],[0.9135,-0.36916],[0.8981,-0.38735],[0.8799,-0.40642],[0.8582,-0.42636],[0.8325,-0.44712],[0.8025,-0.46868],[0.7677,-0.49098],[0.7278,-0.51396],[0.6824,-0.53752],[0.6313,-0.56159],[0.5743,-0.58607],[0.5112,-0.61084],[0.4417,-0.63577],[0.3656,-0.66068],[0.2827,-0.68536],[0.1928,-0.70957],[0.0957,-0.73306],[ -0.009, -0.7556],[ -0.126, -0.77603],[ -0.254, -0.79506],[ -0.392, -0.81245],[ -0.539, -0.82799],[ -0.694, -0.84146],[ -0.856, -0.85267],[ -1.024, -0.86141],[ -1.197, -0.86749],[ -1.373, -0.87075],[ -1.554, -0.87104],[ -1.737, -0.86825],[ -1.921, -0.86225],[ -2.104, -0.8529],[ -2.286, -0.84009],[ -2.466, -0.8237],[ -2.643, -0.80362],[ -2.816, -0.77976],[ -2.984, -0.75202],[ -3.145, -0.72033],[ -3.299, -0.68462],[ -3.444, -0.64483],[ -3.579, -0.6009],[ -3.702, -0.5528],[ -3.812, -0.50049],[ -3.907, -0.44392],[ -3.986, -0.38306],[ -4.046, -0.31789],[ -4.088, -0.24838],[ -4.109, -0.17451],[ -4.11, -0.09626],[ -4.09, -0.0136]]




    make_map(motor_data)
